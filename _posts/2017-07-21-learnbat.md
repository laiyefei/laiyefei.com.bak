---
layout: detail
title: 批处理 学习笔记（一） 【windows篇（基础篇）】
tags: windows 脚本
categories: 编程语言 运维
---

* TOC
{:toc}

# 序言
以前笔者总想着打开电脑，随便敲几个字符，就能做好我想要做的事情，随随便便敲几个字符就能入侵一切。看来要做到这些事情必须很深入的了解操作系统了，底层原理可不是一朝一夕就能学会的（← _ ← ... 以后笔者有空再研究吧），其实要做到这些装逼的事情，只要学习**批处理**脚本就够了。

# 大纲
既然接触windows，那么系统的批处理语言的掌握，可以减少很多工作量。说干就干，学起来吧，**批处理** ！

## 定义
首先上个定义：
~~~
批处理【batch】，也称为批处理脚本【当然是脚本，因为直接高级语言解释执行】或者宏，批处理就是对某对象进行批
量的处理，通常被认为是一种简化的脚本语言，它应用于DOS和Windows系统中。批处理文件的扩展名为bat 。批处理程
序虽然是在命令行环境中运行，但不仅仅能使用命令行软件，任何当前系统下可运行的程序都可以放在批处理文件中运行。
定义泛化：还包括许多软件自带的批处理语言，如 Microsoft Office、Visual Studio、Adobe Photoshop 所内置的
批处理语言的功能，用户可通过它们让相应的软件执行自动化操作（例如调整某个资料夹所有 PSD 图档的解析度）。 而
这类批处理语言也大多提供把一系列操作录制为批处理文件的功能，这样用户不必写程式就能得到批处理程序。
~~~

## 解析

### 工作原理
解析批处理，笔者现阶段还没深入操作系统，对于内部的执行机制还不是很清楚【← _ ← ...以后学到了再深入解说吧】，只能大概说下原理了：<br />
**批处理脚本** 就是在 **操作系统** 内核之外的称为 **壳** 的层执行的，一个产品完工之后，核心的东西是内聚起来的，就像一个黑盒子一样，对于使用者来说，他没必要知道内核的实现原理，但是又要使用功能，所以一般都会在产品之外包裹一层称为 **shell** 的层，而用户就可以通过 **shell** 层，调用内核的功能，用户与 **shell** 层交互的语言随着操作系统不一样而不同，但是大同小异，windows内的交互语言就是批处理语言，通过 **cmd.exe** 应用程序执行脚本。

### 命令解释
笔者这里就记录下，并解释批处理命令：
~~~

   指  令  |           解  释                     |     语   法                                     
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   @       |      关闭当前命令行回显               |   @ 【命令】                                     
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   %       |      批处理中的参数                  |    参数【多个%一起使用情况除外，非常特殊，用法复杂】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   |       |      命令管道符                      | 第一条命令|第二条命令|[| 第三条命令......] 【把前一命令的输出结果当后一命令的输入参数来使用】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   >、>>   |      输出重定向符                    |  【“>”：清除 + 写入；“>>”：清除 + 附加】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   <       |      输入重定向符                    |   从文件中读入命令输入，而不是从键盘中读入。
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   >&      |将一个句柄的输出写入到另一个句柄的输入中 |        
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   <&      |将一个句柄的输入写入到另一个句柄的输出中 |
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ^       |      转义字符                        |   ^[特殊符号] 【去除特殊意义】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   &       |      组合命令符                      |   第一条命令 & 第二条命令 [& 第三条命令...] 【不管是否失败】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   &&      |      组合命令符                      |   第一条命令 && 第二条命令 [&& 第三条命令...] 【失败停止】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ||      |      组合命令符                      |   第一条命令 ||第二条命令[||第三条命令...] 【成功停止】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ""      |      字符串界定符                    |   【表示双引号内的内容界定为字符。】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ECHO    |      回显命令                        |   ECHO [on/off] 【打开/关闭回显（可用@关闭本身）】  
           |                                     |   ECHO [message] 【输出信息】                     
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   REM     |      注释【回显打开显示】             |   REM [注释内容]                                 
   ::      |      注释【回显后仍不显示】           |   :: [注释内容] 【有效标号（:(数字/字母)）/无效标号（:(特殊符号)）】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   PAUSE   |      暂停【并显示请按任意键继续...】   |   PAUSE   
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   TITLE   |      标题【设置命令提示符窗口标题】    |   TITLE [message] 【指定命令提示窗口的标题（可以用来显示程序进度）】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   COLOR   |      颜色【设置前景，背景颜色】       |    COLOR [attr] 【两位16进制数字】【注：0.黑色 | 1.蓝色 | 2.绿色 |
           |                                     | 3.湖蓝色 | 4.红色 | 5.紫色 | 6.黄色 | 7.白色 | 8.灰色 | 9.淡蓝色 |
           |                                     | A.淡绿色 | B.淡浅绿色 | C.淡红色 | D.淡紫色 | E.淡黄色 | F.亮白色 】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   MODE    |      配置系统设备                    |   MODE CON COLS=[x] LINES=[y] 【设置窗口大小 x:宽 | y:高】
           |                                     |   MODE CON CP SELECT=[x] 【设置字符集编码】【注：1258.越南语 | 1257.波罗的语 |
           |                                     | 1256.阿拉伯语 | 1255.希伯来语 | 1254.土耳其语 | 1253.希腊语 | 1252.拉丁字符（ANSI）
           |                                     | 1251.西里尔语 | 1250.中欧语言 | 950.繁体中文 | 949.朝鲜语 | 936.简体中文 |
           |                                     | 932.日语 | 874.泰国语 | 850.多语种（MS-DOS Latin1） | 437. MS-DOS 美国英语
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   GOTO    |      无条件跳转命令                  |   GOTO [:label/label] 【跳转到指定批处理程序中用作标签的文字字符串（GOTO + IF 可以循环）】
           |                                     |   GOTO :EOF 【用于退出批处理】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   CALL    |      无跳转跳转命令                  |   CALL [:label] 【跳转到指定批处理程序中用作标签的文字字符串（程序段执行完会跳回）】
           |                                     |   CALL [[drive:][path] FileName [BatchParameters]] [:Label [Arguments]]
           |                                     |   【注1： 可以用来嵌套和递归】
           |                                     |   【注2： 延迟执行】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   EXIT    |      退出命令                        |   EXIT 【将直接关闭并返回到曾启动 cmd.exe 的程序或返回到“资源管理器”。】
           |                                     |   EXIT [/B] [exitCode] 【返回退出编号，可以知道程序的执行情况】  
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   START   |      启动另一个窗口运行指定的程序或命令|   START ["title"] [/PATH] [/I] [/MIN] [/MAX] [/SEPARATE | /SHARED]
           |                                     | [/LOW | /NORMAL | /HIGH | /REALTIME | /ABOVENORMAL | /BELOWNORMAL]
           |                                     | [/WAIT] [/B] [command/programe] [parameters]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   SHIFT   |      更改批处理文件中可替换参数的位置  |   SHIFT [/n]   
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 ERRORLEVEL|      程序返回码                      |   echo %ERRORLEVEL% 【查看返回码，用来查看程序是否执行成功，执行情况】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   IF      |      执行批处理程序中的条件处理       |    IF [NOT] ERRORLEVEL number command 【结果判断】
           |                                     |    IF [NOT] string1==string2 command 【比对判断】
           |                                     |    IF [NOT] EXIST FileName command 【存在判断】
           |                                     |    【ps. equ:等于 | neq:不等于 | lss:少于 | leq:少于或等于 |
           |                                     | gtr:大于 | geq:大于或等于 | /i:忽略大小写】
           |                                     |    【注1. 区分大小写】
           |                                     |    【注2. 第一个IF后跟()】
           |                                     |    【注3. else 必须和 IF 在同一行】
           |                                     |    【注4. IF 嵌套换行，要用()包起来】
           |                                     |    【注5. IF 条件后面一定要跟一个空格】
           |                                     |    【注6. IF 一次只能判断一个条件 | 多条件用嵌套判断 IF条件 IF条件 ... 】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
SETLOCAL ENABLEDELAYEDEXPANSION | 延迟变量        |    SETLOCAL ENABLEDELAYEDEXPANSION
                                |                |    【注1. SET:设置 | LOCAL:本地 | ENABLE:能够 | DELAYED:延迟 | EXPANSION:扩展】
                                |                |    【注2. ()内的语句都叫做复合语句】
                                |                |    【注3. 用管道命令 & 或 && 或 | 或 || 连接起来的命令也是复合语句 】
                                |                |    【注4. 启动变量延迟 用 %var% 取出之前变量；用 !var! 取出即时变量】
                                |                |    【注5. 如果没有延迟变量，复合语句执行完，依然能得到 %var% 的值，但是没法即时知道】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
    SET    |              赋值                   | SET [variable=[string]] 【注1. 不允许变量名含有等号。】     
           |                                     |SET /a A=B=C=D=[string] 【注2. 借助 /a 可以统一进行赋值；使右边表达式支持数学符号运算】
           |                                     |SET /P variable=[promptString][$UserInput] 【注3. /P 将用户所有输入的字符会赋值到变量上面】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
    FOR    |              循环                   |     FOR %%variable IN (set) DO command [command-parameters] 【粗略】
           |                                     |  FOR [-d | -l | -r | -f] %%variable IN (set) DO command [command-parameters] 【详细】
           |                                     |  FOR [-d | -l | -r | -f] %%变量名   IN (相关文件或命令) DO [执行命令] 【中文翻译】
           |                                     |  【注1. 批处理中需要%%，两个，命令行一个】
           |                                     |  【注2. /d 只搜索当前目录下的目录；不搜索隐藏的】
           |                                     |  【注3. /r 只搜索目录中（包括子目录和子目录的子目录，也就是目录树）的所有文件（非隐藏）】
           |                                     |  【注4. /l 语法：FOR /L %%variable IN (start,step,end) DO command [command-parameters] |                                     | 从start开始，以step为步长，直至接近end那个整数为止，这中间有多少个整数，do后面就执行多少次。
           |                                     | 附. 无限循环demo:  for /l %%i in () do echo Hello 】
           |                                     |  【注5. /f 语法：FOR /F ["options"] %%variable IN (file-set) DO command [parameters]
           |                                     | 附. options：eol=c、skip=n、delims=xxx、tokens=x,y,m-n、usebackq；
           |                                     |说明. 它能够对字符串进行操作，也能够对命令的返回值进行操作，还可以访问硬盘上的 ASCII 码文件，比
           |                                     |如 txt 文档等。常用于文本信息编辑， 如查询、提取、替换等等。 】
-----------------------------------------------------------------------------------------------------------------------------------------

~~~

### 系统变量

系统安装完，默认存在变量，笔者记录下来，感觉以后会用到：<br />

~~~
             变 量        |   变 量 类 别   |   说   明
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %ALLUSERSPROFILE%    |     本地       |   返回“所有用户”配置文件的位置。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %APPDATA%            |     本地       |   返回默认情况下应用程序存储数据的位置。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %CD%                 |     本地       |   返回当前目录字符串。也就是获得当前路径，并将其转换为字符串。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %CMDCMDLINE%         |     本地       |   返回用来启动当前的 Cmd.exe 的准确命令行。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %CMDEXTVERSION%      |     系统       |   返回当前的“命令处理程序扩展”的版本号。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %COMPUTERNAME%       |     系统       |   返回计算机名称。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %COMSPEC%            |     系统       |   返回命令行解释器可执行程序的准确路径。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %DATE%               |     系统       |   返回当前日期字符串。和使用 date/t 效果一样。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %ERRORLEVEL%         |     系统       |   返回上一条命令的错误代码。通常用 0 表示正确，非零表示错误。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %HOMEDRIVE%          |     系统       |  返回连接到用户主目录的本地工作站驱动器号。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %HOMEPATH%           |     系统       |  返回用户主目录的完整路径。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %HOMESHARE%          |     系统       |   返回用户的共享目录的网络路径。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %LOGONSERVER%        |     本地       |   返回验证当前登录会话的域控制器的名称。
--------------------------+----------------+----------------------------------------------------------------------------------------------
  %NUMBER_OF_PROCESSORS%  |     系统       |   指定安装在计算机上的处理器数目(所有 CPU 的总核心数)。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %OS%                 |     系统       |   返回操作系统名称
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %PATH%               |     系统       |    指定可执行文件的搜索路径。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %PATHEXT%            |     系统       |    返回操作系统认为可执行的文件扩展名的列表。
--------------------------+----------------+----------------------------------------------------------------------------------------------
 %PROCESSOR_ARCHITECTURE% |     系统       |    返回处理器的芯片体系结构。
--------------------------+----------------+----------------------------------------------------------------------------------------------
  %PROCESSOR_IDENTFIER%   |     系统       |    返回处理器说明
--------------------------+----------------+----------------------------------------------------------------------------------------------
   %PROCESSOR_LEVEL%      |     系统       |    返回计算机上安装的处理器型号。
--------------------------+----------------+----------------------------------------------------------------------------------------------
   %PROCESSOR_REVISION%   |     系统       |    返回处理器版本号。
--------------------------+----------------+----------------------------------------------------------------------------------------------
      %PROMPT%            |     本地       |    返回当前解释程序的命令提示符设置。由 cmd.exe 生成。    
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %RANDOM%             |     系统       |    返回 0 到 32767 之间的任意十进制数字。由 cmd.exe 生成。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %SYSTEMDRIVE%        |     系统       |    返回包含Windows server operation system根目录（即 系统根目录）的驱动器。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %SYSTEMROOT%         |     系统       |    返回 Windows server operation system 根目录位置。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %TEMP% 和 %TMP%      |   系统 和 用户  | 返回对当前登录用户可用的应用程序所使用的默认临时目录。有些应用程序需要TEMP，而其他应用程序则需要TMP。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %TIME%               |     系统       |    返回当前时间字符串。使用与 time /t 命令相同的格式。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %USERDOMAIN%         |     本地       |    返回包含用户账户的域的名称。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %USERNAME%           |     本地       |     返回当前登录的用户的名称。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %USERPROFILE%        |     本地       |     返回当前用户的配置文件的位置。
--------------------------+----------------+----------------------------------------------------------------------------------------------
     %WINDIR%             |     系统       |     返回操作系统目录的位置。
------------------------------------------------------------------------------------------------------------------------------------------  
~~~

### 运算符优先级

~~~

          符号            |             注释                |   优先级    |          备注             
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
          ()              |            分组                |      1      |
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       !  ~  -            |         一元运算符              |      2      |      -是负号，表示负数
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       *  /  %            |         算术运算符              |      3      |     %是求余数运算，例如 100%3=1
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       +  -               |         算术运算符              |      4      |     
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       <<  >>             |        二进制逻辑位移           |      5      |      输入表达式时，符号需要添加双引号
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       &                  |        二进制按位“与”           |      6      |      输入表达式时，符号需要添加双引号
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       ^                  |        二进制按位“异”           |      7      |      输入表达式时，符号需要添加双引号
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       |                  |        二进制按位“或”           |      8      |      输入表达式时，符号需要添加双引号
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
       =    *=  /=        |        算术赋值                 |      9      |      输入表达式时，符号需要添加双引号
       %=  +=  -=         |                                |             |
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
      &=  ^=  |=          |        二进制算术赋值           |      10     |      输入表达式时，符号需要添加双引号
      <<=  >>=            |                                |             |  
--------------------------+--------------------------------+-------------+----------------------------------------------------------------
      ,                   |        表达式分隔符             |      11     |
------------------------------------------------------------------------------------------------------------------------------------------

~~~



## 求知
学习批处理的原因，笔者这里归结如下：
~~~
1. 装逼
   这个当然是第一个理由，windows操作系统那么普遍，你不用安装应用程序，
打开cmd直接开始打一些字符，谁也看不懂，又完成了任务，逼格多高。
2. 执行方便
   批处理不需要编译器，脚本语言解释执行很方便。
3. 使用方便
   你可以编写一堆批处理文件用来完成某些功能，并且记录下来，以后执行类似
的功能就很方便，打开即可，又可以减少工作量。
4. 简洁
   完成某些功能，比其他的语言简洁，只要一句简单的语句就能实现。
5. 功能强大
   批处理脚本可以做很多GUI上面不能做的事情，比如，把文件属性修改成系统文件等。
6. 黑客必备
   无论是攻击，还是防御，黑客都需要懂批处理知识，现在的计算机一般都有装操作系统，
作为专业的黑客，交互操作系统显得很重要了。
~~~

## 创意
用批处理，可以在操作系统层面上解决很多事情，简化工作，比如：<br />
1. 自动化部署 <br/>
2. 任何想在应用程序完成的事情，批处理都能解决。

# 总结
本篇讲的是windows下的批处理，列出一些基础的，常用的命令，属于基础篇，然而，批处理命令还很多，笔者以后学到的时候再列出来吧。

<br />
↓
→ 简而言之，**批处理** 就是通过 **壳** 进行 **内核调用** 执行 **相应工作** 的 **脚本** 。


**（以上，仅代表个人观点。无论对错，欢迎交流。^_^ ）**
