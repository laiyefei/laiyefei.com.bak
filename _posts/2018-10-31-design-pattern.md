---
layout: detail
title: 设计模式整理
tags: java 设计模式 思想 架构
categories: 设计模式 架构
---

* TOC
{:toc}


# 序言

最近在学设计模式，对此进行一番梳理。


# 大纲

## 原则

~~~

1. 依赖倒置原则 【DPI】
	高层模块【稳定】不应该依赖于低层模块【变化】，二者应该依赖于抽象【稳定】；
	抽象【稳定】不应该依赖于实现细节【变化】，实现细节应该依赖与抽象【稳定】；

2. 开放封闭原则 【OCP】
	对扩展开放，对更改封闭；
	类模块应该是可更改，但是不可修改；

3. 单一职责原则 【SRP】
	一个类应该仅有一个引起它变化的原因；
	变化的方向隐含着类的责任；

4. Liskov 替换原则 【LSP】
	子类必须能够替换它们的基类（IS-A）；
	继承表达类型抽象；

5. 接口隔离原则 【ISP】
	不应该强迫用户程序依赖它们不用的方法；
	接口应该小而完备；

6. 优先使用组合，而不是继承
	类继承 -> 白箱复用； 类组合 -> 黑箱复用；
	继承在某种程度上破坏了封装性，子类父类耦合度极高；
	组合则要求被组合对象有良好定义的接口，耦合度低；

7. 封装变化点
	使用封装来创建对象之间的分界层，让设计者可以在分界层变化一侧进行修改，从而减小耦合；

8. 针对接口编程，而不是针对实现编程
	不将变量声明成某个特定具体类，而是声明为某个接口；
	用户程序无需获知对象的具体类型，只需要知道对象所依赖的接口；
	减少系统中各部分的依赖关系，从而实现“高内聚，松耦合”的类型设计方案；

~~~


## 模式

### 组件协作

#### 模板方法 【Template Method】

~~~
晚绑定：
==========================================================
library 【稳定点】
----------------------------------------------------------
||
VV
----------------------------------------------------------
application 【变化点】
==========================================================
~~~


#### 策略模式 【Strategy】

~~~
==========================================================
运行上下文： -> 虚指针 【稳定点】
==========================================================
超类：抽象类；接口 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
子类：继承父类，或实现接口 【变化点】
==========================================================
~~~

#### 观察者模式 【Observer/Event】

~~~
==========================================================
基类： -> 虚指针 【稳定点】
==========================================================
观察者：抽象类；接口 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
观察者子类：继承观察者；或实现接口 【变化点】
==========================================================
业务类：继承基类；业务逻辑 【变化点】
==========================================================
~~~


### 单一职责

#### 装饰模式 【Decorator】

~~~
==========================================================
抽象类；接口 【稳定点】
==========================================================
基类：继承抽象类；实现接口 【稳定点】
==========================================================
装饰类： 继承抽象类；实现接口； -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
实现类：继承装饰类 【变化点】
==========================================================
运行时装配 【变化点】
==========================================================
~~~

#### 桥模式 【Bridge】

~~~
==========================================================
抽象类；接口； -> 虚指针 【稳定点】
==========================================================
基类：实现了接口 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
抽象子类：继承抽象类； 【变化点】
==========================================================
实现类： 继承基类 【变化点】
==========================================================
运行时组合 【变化点】
==========================================================
~~~

### 对象创建

#### 工厂方法 【Factory Method】

~~~
==========================================================
抽象类；接口；工厂类 【稳定点】
==========================================================
基类； -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
实现类：继承；实现抽象；创建对象 【变化点】
==========================================================
运行时传入 【变化点】
==========================================================
~~~


#### 抽象工厂方法 【Abstract Factory】

~~~
==========================================================
抽象类：接口；工厂类；绑定一系列变化对象 【稳定点】
==========================================================
实现类：创建对象 -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
实现类： 继承；实现接口； 【变化点】
==========================================================
~~~


#### 原型模式 【Prototype】

~~~
==========================================================
抽象类：原型类；clone() 【稳定点】
==========================================================
实现类： 创建对象[clone()] -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
实现类：继承抽象类；实现接口；重写clone() 【变化点】
==========================================================
~~~


#### 创建者模式 【Builder】

~~~
==========================================================
基类：init() 构建流程不变 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
实现类： 继承基类；重写每个构建步骤 【变化点】
==========================================================
运行时创建； -> 虚指针 【变化点】
==========================================================
~~~


### 对象性能

#### 单件模式 【Singleton】

~~~
==========================================================
基类： 不允许外部创建对象，通过内部getInstance()返回 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
----------------------------------------------------------
==========================================================
运行时获取 【变化点】
==========================================================
~~~


#### 享元模式 【Flyweight】

~~~
==========================================================
基类： 抽象类；接口 【稳定点】
==========================================================
工厂类： 对象池； -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
实现类： 继承基类；实现接口 【变化点】
==========================================================
运行时创建 【变化点】
==========================================================
~~~


### 接口隔离

#### 门面模式 【Facade】

~~~
==========================================================
基类： facade类 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
内部实现类： 继承；组合；实现； 【变化点】
==========================================================
~~~

#### 代理模式 【Proxy】


~~~
==========================================================
基类： 原始类 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
代理类： 继承基类；增加处理逻辑 【变化点】  
==========================================================
实现类： 继承代理类；继承基类 【变化点】
==========================================================
~~~

#### 中介者模式 【Mediator】


~~~
==========================================================
基类： 抽象类；接口 【稳定点】
==========================================================
中介类： -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
实现类1： 继承抽象类 【变化点】 
==========================================================
实现类2： 继承中介类 【变化点】
==========================================================
运行时装配 【变化点】
==========================================================
~~~

#### 适配器模式 【Adapter】


~~~
==========================================================
目标类： 【稳定点】
==========================================================
原始类： 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
适配类： -> 虚指针 【变化点】
==========================================================
运行时适配
==========================================================
~~~


### 状态变化

#### 备忘录模式 【Memento】


~~~
==========================================================
基类： 抽象类；接口 【稳定点】
==========================================================
备忘录： -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
实现类： 继承抽象类；实现接口 【变化点】 
==========================================================
运行时保存对象 【变化点】 
==========================================================
~~~

#### 状态模式 【State】


~~~
==========================================================
抽象： 抽象类；接口 【稳定点】
==========================================================
实现类： 流程结构不变，状态对象改变 -> 虚指针 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
具体状态： 继承；实现抽象 【变化点】 
==========================================================
运行时调用，修改内部状态对象 【变化点】
==========================================================
~~~


### 数据结构

#### 组合模式 【Composite】


~~~
==========================================================
基类： 抽象类；接口 【稳定点】
==========================================================
组建类： -> 虚指针 【稳定点】 
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
实现类： 继承基类；实现接口 【变化点】
==========================================================
运行时传入，多态调用 【变化点】
==========================================================
~~~

#### 迭代器模式 【Iterator】


~~~
==========================================================
ps: 被泛型编程取代，编译时确定，取代运行时确定的虚指针
==========================================================
基类： -> 虚指针 【稳定点】
==========================================================
迭代器基类： 抽象类；接口 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
继承迭代器基类： 重写方法 【变化点】 
==========================================================
实现类：继承基类； 使用迭代器 【变化点】
==========================================================
运行时装配
==========================================================
~~~

#### 责任链模式 【Chain of Resposibility】


~~~
==========================================================
责任链处理基类： 处理逻辑不变 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
处理类： 继承基类，判断，执行处理逻辑 【变化点】
==========================================================
~~~


### 行为变化

#### 命令模式 【Command】 

~~~
==========================================================
ps. 函数命令封装成对象
==========================================================
命令基类： 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
具体命令： -> 虚指针 继承命令基类 【变化点】 
==========================================================
~~~

#### 访问者模式 【Visitor】

~~~
==========================================================
基类： -> 虚指针 【稳定点】
==========================================================
访问器类： 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
子类： 重写方法 【变化点】 
==========================================================
~~~


### 领域问题

#### 解析器模式 【Interpreter】

~~~
==========================================================
解析器基类： 【稳定点】
==========================================================
----------------------------------------------------------
||
VV
---------------------------------------------------------- 
==========================================================
具体操作类： -> 虚指针 【变化点】 
==========================================================
运行时构造参数 【变化点】
==========================================================
~~~




# 总结

总之，设计模式，并不依赖于具体代码，仅仅是一种设计思想，在实际过程中，要剥离出稳定点与变化点，并用虚指针在运行时多态调用，减少耦合，尽量低成本的抵御需求变化所引起的代码修改；其中要依据场景，对其中的设计原则进行抉择；


**（以上，仅代表个人观点。无论对错，欢迎交流。^_^ ）** 