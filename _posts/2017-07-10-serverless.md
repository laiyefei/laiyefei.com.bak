---
layout: detail
title: serverless 爬坑记（一）
tags: 软件架构 服务器 
categories: 架构
---

* TOC
{:toc}

# 序言

公司突然要求技术分享，来得这么突然，这就很蛋疼了，不过这可是装逼的好时机，来，想想近年来，什么技术最牛逼，什么技术最前沿。 一个名词映入脑海，没错，就是 **serverless 架构**。

## 引言

### 我的世界

我的世界，我做主：<br />
1.**资源无穷**：CPU/磁盘/内存永远都是海量；<br />
2.**网络稳定**：带宽无线/网络永远可达；<br />
3.**我就是Root**：我就是Root，别TM管我；<br />
4.**操作系统**：世界上应该只有一个操作系统，我就是我电脑上的操作系统；<br />
没错，在程序员眼中就应该是这样的世界。<br />

### 别理我

我就想安安静静写代码。<br/>
![一把梭][yibasuo]

# 大纲
所以，你需要**serverless架构**，解析识别代码，计算业务函数，这种事情交给框架去做，关我什么事！

## 是什么？
那么**serverless**到底是什么东西呢？其实，他就是一种服务器的架构，一种新的软件设计范式，是一种最细粒度的云平台服务形态。好像有点抽象(!_!)，来，下面上图，你就懂了。
![服务器进化][serverUp]<br/>
我们的服务器搭建，类似的可以看成人类的进化史，就像最原始的**物理机器时代**到**serverless架构**；<br />

**物理机器时代**：这个服务器架构面对的是服务器实体，需要去考虑很多物理因素，温度，湿度等环境，就等于你要去喝一口水，还得需要去挖口井，取水。![井][waterDeep]

**虚拟机时代**：虚拟机时代就是**IaaS**，基础设施即服务，这相比物理机有了进化了，他利用cpu的虚拟化技术，安装虚拟机，用户不直接接触硬件，通过配置一些基本参数，就能启动虚拟机，是在物理机上的进化，就等于别人的井分给你一点，不用再挖一口井。

**容器时代**：这就是**CaaS**时代，容器即服务，相比虚拟机他有了进步，用户管理的是容器。对比操作系统，粒度缩小了。就好象是有人帮你运输桶装水过来一样。![桶装水][waterContainer]

**应用管理**：这就是**PaaS**时代，平台即服务。相比容器时代，粒度更细了，他不用考虑运行时环境，只需要在应用平台配置信息，根据配置参数，会执行相应的函数。 是应用层面上的可伸缩。

**serverless**：终于到了**serverless**时代，这个就是**BaaS**或者**FaaS**。在这里，用户管理的是应用平台，调用函数是可伸缩的，真正实现了按需的分配。 就像是打开水龙头你能喝到水，关掉了，水就停了。![水龙头][waterFlow]

## 怎么样？

那么，Serverless是怎么架构的呢。很简单，就是 Server + less，翻译过来就是无服务器架构。然而并不是没有服务器，而是不用考虑服务器。其实，他是云的一部分（惭愧得很，两天依然搭建不出私有云 >_<），一般通过第三方平台提供的，就是函数计算（Function Compute），他是一个全托管型的计算服务，通过事件触发执行。当你把业务逻辑代码上传到云平台的时候，函数计算会为你分配资源，以弹性，可靠的方式运行代码。目前主要的厂商有 AWS lambda，google，Microsoft，IBM等；国内还有阿里云和腾讯；<br />
谷歌了一波，发现Serverless的框架主要有：<br />
1.nodejs 的 serverless 不过利用的是AWS lambda，需要注册帐号。<br />
2.fission 依赖于 k8s。（折腾了2天，本地集群还没搭好。 > _ <，什么时候爬出这个坑，再继续写吧）<br />
3.Apex 这是go语言写的框架，踩坑的过程中，又出现了一个错误<br />
~~~
⨯ Error: function foo: MissingRegion: could not find region configuration
~~~
不明觉厉，只能求大神指教了。<br />
4.go-apex 这个调用时候，内部代码又语法错误了。<br />
（沮丧：算了，不爬了，还是用第三方吧，以后再爬这个坑。）<br />
笔者选择了阿里云，写了一段nodejs，测试成功。（先 > _ <搁置吧 )

## 为什么？

那么，为什么选择serverless呢？ <br />
1.当然是**可以装逼**了。<br />
2.函数伸缩性好了，高度弹性。<br />
3.按需调用，多省资源，无需预先分配，粒度更细。<br/>
4.降低运维成本，自动化伸缩了，哪里还需要运维。<br />
5.前沿技术和大牛交流。<br />
但是，每个技术总有它合适的地方，和不合适的地方，serverless还是有缺陷的：<br />
1.由于粒度非常细，导致了开发大型应用的难度。<br />
2.新的开发体验，开发成本增加。<br />
3.安全模型不够成熟，毕竟才出来1年多，需要时间检验。<br />
4.不适合频繁调用的场合。<br />
5.本地开发环境搭建困难，总不能什么都扔在第三方吧。<br />

## 干什么？

适合于：<br />
1.**低频请求场景**<br />
2.**流量突发场景**<br />

# 总结

所以，serverless架构个人认为：它适合于分散的服务调用，是高可用，高扩展到，适合于高并发的应用。 由于函数资源的自动伸缩，压力会被缩小。对于大数据的应用还是有可观的前景的。但是，serverless不能取代一切，如果是频繁调用的函数，这是不合适的，就像你频繁关开水龙头，会造成不必要的开销，降低吞吐量。<br/>
**总之，适合业务的技术才是合适的技术。**<br />
**（以上，仅代表个人观点。无论对错，欢迎交流。^_^ ）**


[yibasuo]: {{"/2017-07-09-yibasuo.png" | prepend: site.imgrepo }}
[serverUp]: {{"/2017-07-09-serverUp.png" | prepend: site.imgrepo }}
[waterDeep]: {{"/2017-07-09-waterDeep.png" | prepend: site.imgrepo }}
[waterContainer]: {{"/2017-07-09-waterContainer.png" | prepend: site.imgrepo }}
[waterFlow]: {{"/2017-07-09-waterFlow.png" | prepend: site.imgrepo }}
