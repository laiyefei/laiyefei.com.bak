---
layout: detail
title: 批处理 学习笔记（二） 【Linux篇（基础篇）】
tags: linux 脚本
categories: 编程语言 运维
---

* TOC
{:toc}

# 序言
作为一个专业的运维，服务器广泛使用linux的年代，不会一点linux的shell编程都不好意思说自己是运维了。<br/>
linux对于笔者来说一直都是一个熟悉又陌生的东西。熟悉，毕竟笔者用过，也搭建过环境；陌生，毕竟每次都要去查指令，对于深入一点的东西就不理解了。饭要一口一口吃，笔者还是想要记录下一些命令，做下笔记，无论是为了以后方便查询，还是为了加深记忆，都感觉有必要做的。

# 大纲
批处理三个字，一般都能想到windows的bat文件，笔者这里不去纠结定义的范畴了，反正，笔者认为，批处理就是批量处理某些事情，而一般应用程序是在操作系统之上的，那么批处理笔者理解为操作系统的脚本了，他能执行你想要执行的任务。所以，笔者这里认为linux的批处理就是linux的脚本，也就是**shell脚本**【其实shell意为壳，区别于核，不止linux，windows也可以叫做shell脚本，但是一般想到的是linux，就像批处理一般想到windows】。

## 定义
首先上个维基百科的定义：
~~~
Shell脚本【英语：Shell script】，又称Shell命令稿、程序化脚本，是一种电脑程序与文本文件，内容由一连串的shell命令组成，经由Unix Shell直译其内容后运作。被当成是一种脚本语言来设计，其运作方式与直译语言相当，由Unix shell扮演命令行解释器的角色，在读取shell脚本之后，依序运行其中的shell命令，之后输出结果。利用shell脚本可以进行系统管理，文件操作等。
在Unix及所有的类Unix系统中，如Linux、FreeBSD等操作系统，都存在shell脚本。依照Unix shell的各种不同类型，shell脚本也有各种不同方言。在DOS、OS/2、Microsoft Windows中的批处理文件，跟shell脚本有类似的功能。
~~~

## 解析
### 工作原理
~~~
执行步骤如下：
(1). 读取用户由键盘输入的命令行。
(2). 分析命令，以命令名作为文件名，并将其它参数改造为系统调用execve( )内部处理所要求的形式。
(3). 终端进程调用fork( )建立一个子进程。
(4). 终端进程本身用系统调用wait4( )来等待子进程完成【如果是后台命令，则不等待】。当子进程运行时调用execve( )，子进程根据文件名【即命令名】到目录中查找有关文件【这是命令解释程序构成的文件】，将它调入内存，执行这个程序【解释这条命令】。
(5). 如果命令末尾有&号【后台命令符号】，则终端进程不用系统调用wait4( )等待，立即发提示符，让用户输入下一个命令，转⑴。如果命令末尾没有&号，则终端进程要一直等待，当子进程【即运行命令的进程】完成处理后终止，向父进程【终端进程】报告，此时终端进程醒来，在做必要的判别等工作后，终端进程发提示符，让用户输入新的命令，重复上述处理过程。
~~~

### 命令解释
linux命令笔者认为有必要收集下，将来也方便查看：

内置：

~~~

   指  令  |           解  释                     |     语   法                                     
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ls      | 显示文件或目录                       |      ls             
           |    列出文件详细信息                  |      ls -l【list】    
           |    列出当前目录下所有文件及目录【隐藏】|      ls -a【all】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   mkdir   | 创建目录                             |      mkdir [路径/文件夹名]
           |    创建目录，若无父目录，则创建        |      mkdir -p【parent】 [路径/文件夹名]                
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   cd      | 切换目录                             |     cd [路径]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   touch   | 创建空文件                           |     touch [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   echo    | 输出内容                             |     echo ["内容"]
           | 输出内容并写入文件                    |     echo ["内容"] > [文件名]
           | 输出内容并附加到文件内容尾部           |     echo ["内容"] >> [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   cat     | 查看文件内容                         |     cat [路径/文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   cp      | 拷贝                                |     cp [文件] [目标文件夹]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   mv      | 移动或者重命名                       |     mv [文件] [目标文件夹/目标文件]【移动或者改名（移动到本身）】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   rm      | 删除文件                             |    rm 【remove】
           |   递归删除，可删除子目录及文件         |    rm -r [文件名]【可以用正则匹配】
           |   强制删除                           |    rm -f [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   find    | 在文件系统中搜索某文件                |    find [文件名]【可以正则】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   wc      | 统计文本中的行数，词数，字符数         |    wc [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   grep    | 在文本文件中查找某个字符串             |    grep [待查找字符][文件]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   rmdir   | 删除空目录                           |     rmdir [文件夹]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   pwd     | 显示当前目录                         |     pwd
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ln      | 链接两个文件【物理上是同一文件】       |     ln [文件1] [文件2]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 more/less | 分页显示文本文件内容                  |     more/less [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 head/tail | 显示文件头尾内容                      |     head/tail [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
===系统命令===============================================================================================================================
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   stat    | 显示指定文件的详细信息                |      stat [文件名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   who     | 显示在线登陆用户                     |      who
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   whoami  | 显示当前操作用户                     |      whoami
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   hostname| 显示主机名                           |     hostname
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   uname   | 显示系统信息                         |     uname
-----------+-------------------------------------+---------------------------------------------------------------------------------------
lsb_release| 显示系统信息                         |     lsb_release -a
-----------+-------------------------------------+---------------------------------------------------------------------------------------
cat /etc/redhat-release| 显示系统信息                         |     cat /etc/redhat-release
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   top     | 动态显示当前资源耗费最多的进程信息     |     top
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ps      | 显示瞬间的进程状态                    |     ps [-aux/-ef]【涉及到参数笔者遇到再补充吧，懒得找了】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   du      | 显示目录大小                         |     du [-h]【带单位】 [路径]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   df      | 显示磁盘大小                         |     df [-h]【带单位】 [路径]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ifconfig| 查看网络情况                         |     ifconfig
   ipconfig|                                     |     ipcofnig
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   ping    | 测试网络连通                         |     ping [ip]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   netstat | 显示网络状态信息                     |     netstat
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   man     | 查看帮助手册                         |     man ls
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   clear   | 清屏                                |     clear
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   alias   | 对命令重命名                         |     alias sherlock="ps -aux"【解除：unaliax sherlock】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   kill    | 杀死进程                             |     kill [进程id]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   gzip    | 打包压缩相关命令                      |     tar -cvf [压缩包路径] [目标路径]
   bzip2   | [-c/-x/-z/-j/-v/-f]【归档文件/压缩文件|     tar -zcvf [压缩包路径] [目标路径]
   tar     |gzip压缩文件/bzip2压缩文件/过程/用档名】|     tar -jcvf [压缩包路径] [目标路径]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   shutdown| 关机                                 |     shutdown [-r/-h/now] 【重启/不重启/立即关机】
   halt    | 关机                                 |     halt
   reboot  | 重启                                 |     reboot
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   grep    | linux管道【a命令输出 → b命令输入】    |     grep -r "close" /home/* | more 【在home目录底下查找，包括close文件，并分页输出】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
===文件权限管理===========================================================================================================================
-----------+-------------------------------------+---------------------------------------------------------------------------------------
   chmod   |  更改权限                            |     R【值：4（读）】，W【值：2（写）】，X【值：1（可执行0】
           |                                     |     【看法：1. 第一个字符 “-”（普通字符），“l”（链接），“d”（目录）；
           |                                     |            2. 第二三四个字符表示当前所属用户的权限。 数值即为相加；
           |                                     |            3. 第五六七个字符表示当前所属组的权限。 数值即为相加；
           |                                     |            4. 第八九十个字符表示其他用户的权限。   数值即为相加；】
           |                                     |sudo chmod [u所属用户  g所属组  o其他用户  a所有用户] [+增权  -减权] [r  w  x] 目录名
           |                                     |【例: sudo chmod 765 [文件名]】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
===用户及用户组管理=======================================================================================================================
-----------+-------------------------------------+---------------------------------------------------------------------------------------
/etc/passwd| 存储用户账号                         |    /etc/passwd
-----------+-------------------------------------+---------------------------------------------------------------------------------------
/etc/group | 存储组账号                           |    /etc/group
-----------+-------------------------------------+---------------------------------------------------------------------------------------
/etc/shadow| 存储用户账号的密码                    |    /etc/shadow
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 useradd   |  添加用户                            |    useradd [用户名]【并没有在/home目录下创建同名文件夹，也没有创建密码】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 userdel   |  删除用户                            |    userdel [用户名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 adduser   |  添加用户                            |    adduser [用户名]【这样在/home目录下会自动创建同名文件夹】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 groupadd  |  添加组                              |    groupadd [组名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 groupdel  |  删除组                              |    groupdel [组名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 passwd    |  设置密码                            |    passwd [用户名]
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 su        |  切换账号                            |    su [用户名] 【不改变到当前用户（加载配置文件.bashrc）】
           |                                     |    su - [用户名] 【改变到当前用户（加载配置文件/etc/profile ，加载bash_profile）】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
/etc/profile| 系统环境变量                        |    /etc/profile
-----------+-------------------------------------+---------------------------------------------------------------------------------------
bash_profile| 用户环境变量                        |    bash_profile 【可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
.bashrc    |  用户环境变量                        |    .bashrc 【当登录时以及每次打开新的shell时,该文件被读取】
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 chown     |  更改文件的用户                     |    sudo chown [-R] owner {File|Directory}
           |                                     |    【例：sudo chown [文件名]】   
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 chgrp     |  更改文件的组                       |    sudo chgrp [-R] group {File|Directory}
           |                                     |    【例：sudo chgrp [文件名]】   
-----------+-------------------------------------+---------------------------------------------------------------------------------------
 rpm       |  rpm安装软件                        |    sudo rpm -ivh [FileName].rpm
-----------+-------------------------------------+---------------------------------------------------------------------------------------

~~~

扩展：

~~~

   扩 展 包           |           解  释                    |     附加命令                                     
---------------------+-------------------------------------+-----------------------------------------------------------------------------
   tree              |   显示树形目录结构                    |      tree [路径]
---------------------+-------------------------------------+-----------------------------------------------------------------------------
   dpkg              |    安装软件                          |      sudo dpkg -i [文件名.deb]
                     |    卸载软件                          |      sudo dpkg -r [软件]
                     |                                     | 【注：sudo alien 文件名.rpm; 将.rpm转为.deb文件；（.rpm是RedHat/ubuntu不能用）】
---------------------+-------------------------------------+-----------------------------------------------------------------------------

~~~

## 求索
linux 与 windows相比有什么优点呢？<br />
笔者只是知道服务器很多都是linux，却没有去纠结其中的道理，看来为了深刻理解，有必要比较一番：<br />
**本质** 上，其实linux和windows就是“free software”的区别了，其实 **“free”** 的本意就是用户按照自己的行为自由，革奴计划就是这么来的，意志自由的软件才是gnu的本意。那么，笔者搜集网上资料，列出几条特征比较一下吧。
~~~
1. 用户自主
     用户是机器的主人，操作系统只是用户请来的助手，用户知道自己要干什么，也明白自己在做什么。用户对自己的行为负责，操作系统尽量少说话，更不要下命令。
2. 用户知情
     如果可以的话，用户可以获取操作系统的任何细节，而不是被告知“正在处理一些事情...”
3. 开发高效
     在linux下，用户可以很容易的获取到各种工具，并且能很容易的组装起来，完成复杂的工作，机器更多是用来干活的。
4. 系统高效
     linux是C写的内核，C已经是很偏底层的语言了，效率肯定不用说了。
5. 大量软件免费
     这个，。。。不用再说了吧
6. 安全性
     独特的内存管理方式，完全可以裸奔。
7. 删除彻底
     尝试，测试软件，一个命令安装，删除，很干净，没有注册表什么的。
8. 合法加入
     合法自定义任何我想要的东西，可以追踪软件开发者，提问题，加入他们；如果是windows估计告你侵权。
9. 适用性广
     可以使用几乎所有硬件，因为系统自带了驱动。
10. ...
~~~

## 创意
linux这么屌，但是最重要的一个方向，就是能用来干嘛？<br/>
~~~
1. 虚拟化
     很多虚拟机其实都是基于linux的。
2. 数据库服务器
     linux占用资源很少，不会和数据库抢夺资源。【稳定性，无内存泄露，快速磁盘I/O，无CPU竞争】
3. web服务器
     【理由同上】
4. 应用服务器
     【理由同上】
5. 日志服务器
      linux是处理和存储日志文件的绝佳平台，听起来这是一个低级的任务，但它的低成本，低硬件要求，和高性能是任何需要日志服务的人的首选平台。
6. 开发平台
      成千上万的免费开发软件，毫无疑问linux是最佳的开发平台。
7. 监控服务
      linux实现自动化监控。
8. 入侵检测系统
      linux天生是一个完美的入侵检测服务平台，因为它是免费的，而且可以运行在很多种硬件平台上，同时也是开源爱好者喜欢的平台。linux上最著名的入侵防御和检测系统要数Snort，它也是开源且免费的。
~~~


# 总结
所以，linux 比 windows 还是挺好的，linux越来越成为服务器的首选，linux越来越火，学习linux shell脚本是很有意义的。本文主要列出来linux的主要命令，不全面，等笔者遇到再补充吧，也是方便以后查询，并分析，比对了linux。<br />
linux 和 windows一样，所有的操作系统和软件设计思想，都是封装了内核，并留一个壳被调用，linux又自由，又好用，效率又高，所以在和系统交互的时候，有必要认真学习linux shell。

<br />
↓
→ 简而言之，**批处理** 就是通过 **壳** 进行 **内核调用** 执行 **相应工作** 的 **脚本** 。


**（以上，仅代表个人观点。无论对错，欢迎交流。^_^ ）**
